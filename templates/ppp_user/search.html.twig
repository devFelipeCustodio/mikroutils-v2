{% extends 'base.html.twig' %}

{% block title %}Hello UserController!
{% endblock %}

{% block body %}
	{{ form_start(form) }}
	{{ form_errors(form) }}
	<div class="mb-3 d-flex">
		<div class="d-flex gap-2 container">
			{{ form_widget(form.query, {"attr": {"class": "py-2 mb-3 container"}}) }}
			<button type="submit" class="px-4 mb-3 btn btn-primary d-flex justify-content-center align-items-center">
				<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960" width="24px" fill="currentColor"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
			</button>
			<button type="button" class="px-4 btn btn-primary mb-3 d-flex justify-content-center align-items-center" data-bs-toggle="modal" data-bs-target="#filterModal">
				<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960" width="24px" fill="currentColor"><path d="M400-240v-80h160v80H400ZM240-440v-80h480v80H240ZM120-640v-80h720v80H120Z"/></svg>
			</button>
			{% if "ROLE_ADMIN" in app.user.roles %}
				<button type="submit" formaction="/export" class="px-4 btn btn-primary mb-3 d-flex justify-content-center align-items-center">
					<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/></svg>
				</button>
			{% endif %}
		</div>
	</div>
	<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="filterModalLabel">Filtrar por gateway</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					{{ form_end(form) }}
				</div>
			</div>
		</div>
	</div>
	{% if results %}
		{% if results.meta.length > 0 %}
			<div class="table-responsive">
				<table class="mb-3 table">
					<thead>
						<tr>
							<th scope="col">Gateway</th>
							<th scope="col">Usuário</th>
							<th scope="col">IP público</th>
							<th scope="col">MAC</th>
							<th scope="col">Tempo ativo</th>
							<th scope="col">Ação</th>
						</tr>
					</thead>
					<tbody>
						{% for gw in results.data %}
							{% for user in gw.data %}
								<tr>
									<td class="py-3">{{ gw.meta.hostname }}</td>
									<td class="py-3">{{ user.name }}</td>
									<td class="py-3">{{ user.address }}</td>
									<td class="py-3">{{ user["caller-id"] }}</td>
									<td class="py-3">{{ user.uptime }}</td>
									<td class="py-3">
										<a href="#">
											<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960" width="24px" fill="currentColor"><path d="M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-520v-200H240v640h480v-440H520ZM240-800v200-200 640-640Z"/></svg>
										</a>
									</td>

								</tr>
							{% endfor %}
						{% endfor %}
					</tbody>
				</table>
			</div>
			<p class="text-end">Exibindo
				{% if results.meta.length == 1 %}
					{{ results.meta.length }}
				{% elseif results.meta.length < results.meta.itemsPerPage %}
					{{ results.meta.length * results.meta.currentPage - results.meta.length + 1  }}-{{ results.meta.length }}
				{% else %}
					{{ results.meta.itemsPerPage * results.meta.currentPage - results.meta.itemsPerPage + 1  }}-
					{%- if results.meta.itemsPerPage * results.meta.currentPage > results.meta.length %}
						{{- results.meta.length -}}
					{% else %}
						{{- results.meta.itemsPerPage * results.meta.currentPage -}}
					{% endif -%}

				{% endif %}
				de
				{{ results.meta.length }}
				items
			</p>
			{% if results.meta.length > results.meta.itemsPerPage  %}
				<nav class="mb-5 d-flex justify-content-center" aria-label="Paginação de resultados de pesquisa">
					<ul class="pagination">
						{% set params = app.request.query %}
						<li class="page-item">
							{% set previousPageParams = params | merge({
								"page" : results.meta.currentPage - 1
							}) %}
							{% set queryString = previousPageParams | url_encode %}
							<a class="page-link {% if not results.meta.previous %} disabled{% endif %}" href="{{ url("app_ppp_user_search")}}?{{ queryString }}">Anterior</a>
						</li>
						<li class="page-item">
							{% set nextPageParams = params | merge({
								"page" : results.meta.currentPage + 1
							}) %}
							{% set queryString = nextPageParams | url_encode %}
							<a class="page-link {% if not results.meta.next %} disabled{% endif %}" href="{{ url("app_ppp_user_search")}}?{{ queryString }}">Próxima</a>
						</li>
					</ul>
				</nav>
			{% endif %}
		{% else %}
			<p>Nenhum resultado encontrado.</p>
		{% endif %}
	{% endif %}
{% endblock %}
